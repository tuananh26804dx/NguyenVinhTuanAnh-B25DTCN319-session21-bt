#include <stdio.h>
#include <string.h>
#include <ctype.h>

#define MAX_NAME_LEN 50
#define STUDENT_COUNT 5

typedef struct {
    char name[MAX_NAME_LEN];
    int age;
    float grade;
} Student;

// Trim trailing newline from fgets input
static void chomp(char *s) {
    if (!s) return;
    size_t len = strlen(s);
    if (len > 0 && s[len - 1] == '\n') {
        s[len - 1] = '\0';
    }
}

// Safely read a line into buffer and trim newline
static void readLine(char *buffer, size_t size) {
    if (fgets(buffer, (int)size, stdin) != NULL) {
        chomp(buffer);
    } else {
        // On EOF or error, make sure buffer is empty string
        if (size > 0) buffer[0] = '\0';
        clearerr(stdin);
    }
}

// Read an integer with prompt
static int readInt(const char *prompt) {
    char line[128];
    int value;
    for (;;) {
        printf("%s", prompt);
        readLine(line, sizeof(line));
        if (sscanf(line, "%d", &value) == 1) {
            return value;
        }
        printf("Nhap khong hop le. Vui long nhap lai mot so nguyen.\n");
    }
}

// Read a float with prompt
static float readFloat(const char *prompt) {
    char line[128];
    float value;
    for (;;) {
        printf("%s", prompt);
        readLine(line, sizeof(line));
        if (sscanf(line, "%f", &value) == 1) {
            return value;
        }
        printf("Nhap khong hop le. Vui long nhap lai mot so thuc.\n");
    }
}

void inputStudents(Student students[], int count) {
    for (int i = 0; i < count; ++i) {
        printf("\nNhap thong tin hoc sinh thu %d:\n", i + 1);
        printf("Ten: ");
        readLine(students[i].name, sizeof(students[i].name));
        students[i].age = readInt("Tuoi: ");
        students[i].grade = readFloat("Diem trung binh: ");
    }
}

void printStudent(const Student *s) {
    if (!s) return;
    printf("Ten: %s\n", s->name);
    printf("Tuoi: %d\n", s->age);
    printf("Diem trung binh: %.2f\n", s->grade);
}

// Case-sensitive exact name match search; returns index or -1 if not found
int findStudentByName(const Student students[], int count, const char *name) {
    for (int i = 0; i < count; ++i) {
        if (strcmp(students[i].name, name) == 0) {
            return i;
        }
    }
    return -1;
}

int main(void) {
    Student students[STUDENT_COUNT];

    // Input data
    inputStudents(students, STUDENT_COUNT);

    // Search by name
    char query[MAX_NAME_LEN];
    printf("\nNhap ten hoc sinh can tim: ");
    readLine(query, sizeof(query));

    int idx = findStudentByName(students, STUDENT_COUNT, query);
    if (idx >= 0) {
        printf("\nDa tim thay hoc sinh:\n");
        printStudent(&students[idx]);
    } else {
        printf("\nKhong tim thay hoc sinh co ten '%s'.\n", query);
    }

    return 0;
}
